# Copyright (C) 2001-2016 Quantum ESPRESSO group
#
# This program is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License
# as published by the Free Software Foundation; either version 2
# of the License. See the file `License' in the root directory
# of the present distribution.
#
# Utilities

###########################################################
# Template function
# $(1) = package name
# $(2) = package URL
# $(3) = directory name
# $(4) = plugin/code name
###########################################################

define download_and_unpack
  @extracted_namefile=`echo "$(2)" | sed 's/.*\///' | sed 's/.*=//'`
  @(if test ! -s ../archive/$extracted_namefile && test ! -d ../$(3) ; then \
  wget -O ../archive/$extracted_namefile $(2) > /dev/null 2>&1; \
  if test "`echo $$?`" -ne "0" ; then \
  curl -o ../archive/$extracted_namefile $(2) > /dev/null 2>&1; \
  if test "`echo $$?`" -ne "0" ; then \
  echo "*** Unable to download $(4). Test whether curl or wget is installed and working," ; \
  echo "*** if you have direct access to internet. If not, copy into archive/ the file" ; \
  echo "*** $extracted_namefile" ; \
  exit 1 ; fi ; fi ; fi)
  if test ! -d ../$(3); then \
  (gzip -dc ../archive/$extracted_namefile | \
    (cd ../ ; tar -xvf - ; ln -s $(1) $(3)) ) ; fi
endef
